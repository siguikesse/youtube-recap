<!DOCTYPE html>
<html>
  <head>
    <title>Youtube Wrapped</title>
    <meta charset="UTF-8" />
    <!-- <style>
      body {
        background-color: #d70000;
        font-family: 'Arial', sans-serif;
        color: #fff;
      }
      h1 {
        font-size: 36px;
        text-align: center;
        margin-top: 50px;
      }
      a:link, a:visited {
        color: white;
      }
      .top-creators{
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        margin-top: 50px;
      }
      .firstVideoOfYear {
        width: 33%;
      }
      .firstVideoOfYear > a > img {
        width: 320px;
        height: 178px;        
        object-fit: cover;
      }
      .top-summary {
        text-align: center;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        margin-top: 50px;
        font-size: 24px;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
      }
      .creator {
        text-align: center;
        margin: 25px;
      }
      .creator-name {
        font-size: 24px;
      }
      .creator-image {
        width: 200px;
        height: 200px;
        border-radius: 100px;
        margin-bottom: 10px;
      }
      .top-videos {
        margin-top: 50px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
      }
      .video {
        display: flex;
        align-items: center;
        margin-top: 25px;
        width: 500px;
      }
      .video-rank {
        font-size: 24px;
        margin-right: 25px;
      }
      .video-name {
        font-size: 24px;
      }
      .video-name > a >  img {
        width: 480px;
        height: 270px;        
        object-fit: cover;
      }
      .top-comments , .top-likes{
        margin-top: 50px;
        display: flex;
        flex-wrap: wrap;
        text-align: center;
        justify-content: space-around;
        font-size: 24px;
      }
      .thumbnail-container{
        width: 320px;
        height: 178px;
        overflow: hidden;
        margin-left: auto;
        margin-right: auto;
      }
      .thumbnail-container > img{
        width: 320px;
        margin: -30px 0 0px 0;
      }
      .comment {
        width: 33%;
      }
      .comment > a > img {
        width: 320px;
        height: 178px;        
        object-fit: cover;
      }
      .commentCreator {
        text-align: left;
        margin: 25px;
      }
      .commentCreator > img{
        border-radius: 20px;
        width: 40px
      }
      .commentCreator > a{
        vertical-align: super;

      }


    </style> -->
    <link rel="stylesheet" href="style.css">

  </head>

  <body>
    <div id="zipUpload">
      <a href="https://twitter.com/share?url=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAAGElEQVQIW2P4DwcMDAxAfBvMAhEQMYgcACEHG8ELxtbPAAAAAElFTkSuQmCC&text=IMAGE_TEXT" target="_blank">
        <button>Share on Twitter</button>
      </a>
      <h3>Choose the takeout zip file</h3>
      <p class="note">
        Generate the zip on takeout.google.com
        </br>
        Export only youtube data (watch history, comments ans playlist )
        </br>
        Your data is not sent anywhere. Works even offline.
      </p>
      <input type="file" id="file" name="file" accept="zip" /><br/>
    </div>

    <div class="top-summary"></div>
    <div class="top-creators"></div>
    <div class="top-video"></div>
    <div class="top-likes"></div>
    <div class="top-comments"></div>

    <!-- <button>Share on twitter</button> -->

    
    <script type="text/javascript" src="https://stuk.github.io/jszip/test/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="https://stuk.github.io/jszip/dist/jszip.js"></script>
    <script src="./csv/index.min.js"></script>
    <script type="text/javascript" src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script type="text/javascript" src="utils.js"></script>

    <script>
      $("#file").on("change", function (event) {
        // Closure to capture the file information.
        let file = event.target.files[0];

        JSZip.loadAsync(file) // 1) read the Blob
        .then(function (content) {
          if (Object.keys(content.files).includes('Takeout/YouTube and YouTube Music/history/watch-history.json')){
            return content.files[ "Takeout/YouTube and YouTube Music/history/watch-history.json" ].async("text");
          } else if (Object.keys(content.files).includes('Takeout/YouTube y YouTube Music/historial/historial-de-reproducciones.json')){
            return content.files[ "Takeout/YouTube and YouTube Music/historial/historial-de-reproducciones.json" ].async("text");
          } else if (Object.keys(content.files).includes('Takeout/YouTube et YouTube Music/historique/watch-history.json')){
            return content.files[ "Takeout/YouTube et YouTube Music/historique/watch-history.json" ].async("text");
          }else{
            console.log( Object.keys(content.files) )
            alert("can't find watch-history.json")
          }
        })
        .then(function (text) {
          $( "#zipUpload" ).replaceWith( "" );
          let history = JSON.parse(text);
          
          let history2022 = history.filter(filterCurrentYear)
          history2022 = history2022.filter(filterRemovedVideos)
          console.log(history2022)
          topCreators(history2022);
          topVideos(history2022);
          topSummary(history2022);

          // likes
          JSZip.loadAsync(file) 
          .then(function (content) {
            if (Object.keys(content.files).includes("Takeout/YouTube and YouTube Music/playlists/Liked videos.csv")){
              return content.files[ "Takeout/YouTube and YouTube Music/playlists/Liked videos.csv" ].async("text");
            } else if (Object.keys(content.files).includes("Takeout/YouTube y YouTube Music/playlists/Liked videos.csv")){
              return content.files[ "Takeout/YouTube y YouTube Music/playlists/Liked videos.csv" ].async("text");
            } else if (Object.keys(content.files).includes("Takeout/YouTube et YouTube Music/playlists/Liked videos.csv")){
              return content.files[ "Takeout/YouTube et YouTube Music/playlists/Liked videos.csv" ].async("text");
            }else{
              console.log( Object.keys(content.files) )
              alert("can't find Liked videos.csv")
            }
          })
          .then(function (text) { 
            let parsed = parse(text, {},(value, row, col) => {
              return col === 1 ? "https://www.youtube.com/watch?v=" + value : Date.parse(value);
            }).splice(4)
            parsed.pop() // remove last empty row
            topLikes(parsed,history2022)
          });

          // comments
          JSZip.loadAsync(file) 
          .then(function (content) {
              if (Object.keys(content.files).includes("Takeout/YouTube and YouTube Music/my-comments/my-comments.html")){
                return content.files[ "Takeout/YouTube and YouTube Music/my-comments/my-comments.html" ].async("text");
              } else if (Object.keys(content.files).includes("Takeout/YouTube and YouTube Music/playlists/Liked videos.csv")){
                return content.files[ "Takeout/YouTube and YouTube Music/playlists/Liked videos.csv" ].async("text");
              } else if (Object.keys(content.files).includes("Takeout/YouTube and YouTube Music/playlists/Liked videos.csv")){
                return content.files[ "Takeout/YouTube and YouTube Music/playlists/Liked videos.csv" ].async("text");
              } else{
              console.log( Object.keys(content.files) )
              alert("can't find my-comments.html")
            }
          })
          .then(function (text) { //replace with read of multiple file then return array of usefile files instead of lodading 3times
            let comments = $(text)[2].childNodes;
            let commentsList = getCommentsList(comments)
            topComments(commentsList, history2022);

            let options= {
              backgroundColor: "#000000",
              allowTaint: true,
              useCORS:true
            }

            html2canvas(document.querySelector(".top-comments"),options).then(function(canvas) {
                document.body.appendChild(canvas);
                canvas.toBlob((blob)=>{ // save to clipboard
                  try {
                    navigator.clipboard.write([
                        new ClipboardItem(
                            Object.defineProperty({}, blob.type, {
                        value: blob,
                        enumerable: true
                      })
                        )
                    ]);
                  } catch (error) {
                      console.error(error);
                  }
                })
            });


          });
        });
      });



    </script>
  </body>
</html>



<!-- 
  last video
  oldest video
  latest liked video
  total channel watched
  total video watched
  random video

  no reupload
  share
 -->
